<div id="cmp-monitoring_booked_reports" class="app_content-container-cmp">
	<div *ngIf="componentAlert.show" class="alert_box">
		<alert [type]="componentAlert.type" [dismissible]="componentAlert.dismissible" (close)="this._utilityService.setAlert(this.componentAlert)">
			<span [innerHTML]="componentAlert.message | translate"></span>
		</alert>
	</div>
	<h2 class="view-header">
		<div class="view-header-sub">
			{{ 'fe.monitoringBookedReports.mainHeader' | translate }}
		</div>
	</h2>

	<form [formGroup]="_monBookedRepService.monBookedRepForm" (ngSubmit)="submitMonBookedRepForm(_monBookedRepService.monBookedRepForm)" class="mon-booked-reports-filter clearfix">
		<div class="col-md-2">
			<label>{{ 'fe.monitoringBookedReports.filterFromDate' | translate }}</label>
			<span class="glyphicon glyphicon-remove pull-right" aria-hidden="true" (click)="clearField('filterDateFrom')"></span>
			<p-calendar formControlName="filterDateFrom" readonlyInput="readonlyInput" [maxDate]="_monBookedRepService.monBookedRepForm.value.filterDateTo ? _monBookedRepService.monBookedRepForm.value.filterDateTo : maxDate"
				placeholder="{{ 'fe.generalComponentContent.selectDate' | translate }}" [yearNavigator]="true" [monthNavigator]="true" yearRange="2016:2030"
				dateFormat="yy-mm-dd" (onSelect)="validateFilter()" styleClass="date_input"
				inputStyleClass="form-control">
			</p-calendar>
			<span class="label label-danger pull-right" *ngIf="_monBookedRepService.monBookedRepForm.value.filterDateFrom &&
				_monBookedRepService.monBookedRepForm.value.filterDateTo &&
				_monBookedRepService.monBookedRepForm.value.filterDateFrom > _monBookedRepService.monBookedRepForm.value.filterDateTo">{{'fe.monitoringBookedReports.invalidDateTime' | translate}}</span>
		</div>
		<div class="col-md-2">
			<label>{{ 'fe.monitoringBookedReports.filterToDate' | translate }}</label>
			<span class="glyphicon glyphicon-remove pull-right" aria-hidden="true" (click)="clearField('filterDateTo')"></span>
			<p-calendar formControlName="filterDateTo" readonlyInput="readonlyInput" [minDate]="_monBookedRepService.monBookedRepForm.value.filterDateFrom"
				placeholder="{{ 'fe.generalComponentContent.selectDate' | translate }}" [yearNavigator]="true" [monthNavigator]="true" yearRange="2016:2030"
				dateFormat="yy-mm-dd" (onSelect)="validateFilter()" styleClass="date_input"
				inputStyleClass="form-control">
			</p-calendar>
			<span class="label label-danger pull-right" *ngIf="_monBookedRepService.monBookedRepForm.value.filterDateFrom &&
				_monBookedRepService.monBookedRepForm.value.filterDateTo &&
				_monBookedRepService.monBookedRepForm.value.filterDateFrom > _monBookedRepService.monBookedRepForm.value.filterDateTo">{{'fe.monitoringBookedReports.invalidDateTime' | translate}}</span>
		</div>
		<div class="col-md-4" *ngIf="isCompanyFilter">
			<lazyload-dropdown #companiesLazyDropDown formControlName="filterCompany" [value]="_monBookedRepService.cmbCompany" [label]="'fe.generalComponentContent.company' | translate"
				[clear]="true" display="name" [placeholder]="'fe.generalComponentContent.select' | translate" [filterPlaceholder]="'fe.generalComponentContent.search' | translate"
				(onChange)="validateFilter('filterCompany')">
            </lazyload-dropdown>
		</div>
		<div class="col-md-4" *ngIf="isUsernameFilter">
			<lazyload-dropdown #usersLazyDropDown formControlName="filterUsername" [value]="_monBookedRepService.cmbUsername" [label]="'fe.generalComponentContent.user' | translate"
				[clear]="true" display="name" [placeholder]="'fe.generalComponentContent.select' | translate" [filterPlaceholder]="'fe.generalComponentContent.search' | translate"
				(onChange)="validateFilter()" [disabled]="disabledUserFilter">
            </lazyload-dropdown>
		</div>
		<div class="col-md-12 filter_controls">
			<div class="text-right">
				<button type="button" class="btn btn-default" (click)="clearFilter()">{{ 'fe.generalComponentContent.clear' | translate }}</button>
				<button type="submit" class="btn btn-primary" [disabled]="validator">{{ 'fe.generalComponentContent.displayData' | translate }}</button>
			</div>
		</div>
	</form>

	<div class="col-md-2 form-group">
		<input #globalFilter type="text" class="form-control" [placeholder]="'fe.generalComponentContent.search' | translate">
	</div>

	<div class="container-fluid">
		<p-dataTable #monBookedRepDataTable [emptyMessage]="'fe.generalComponentContent.noResultsFound' | translate" [value]="reportList" [rows]="_monBookedRepService.pageRow.rows"
			[paginator]="true" [rowsPerPageOptions]="[5, 10, 15, 20, 25, 50, 100, 250, 500]" [globalFilter]="globalFilter" reorderableColumns="true"
			class="table" (onPage)="changePage($event)">
			<p-column field="bookedDate" [header]="'fe.monitoringBookedReports.colBookedDate' | translate" sortable="true" [style]="{ 'width': '13%' }">
				<template let-report="rowData" pTemplate="body">
					<div class="text-center">
						<b>{{report.bookedDate | date: 'dd.MM.yyyy'}}</b>
					</div>
				</template>
			</p-column>
			<p-column field="reportName" [header]="'fe.monitoringBookedReports.reportName' | translate" sortable="true" [filter]="true" filterMatchMode="contains"
				[style]="{ 'width': '18%' }">
				<template let-report="rowData" pTemplate="body">
					<div class="text-center" [tooltip]="report.reportName" placement="top">{{report.reportName}}</div>
				</template>
			</p-column>
			<p-column field="format" [header]="'fe.monitoringBookedReports.colFormat' | translate" sortable="true" [filter]="true"
				filterMatchMode="contains" [style]="{ 'width': '13%' }">
				<template let-report="rowData" pTemplate="body">
					<div class="text-center">{{report.format}}</div>
				</template>
			</p-column>
			<p-column field="userName" [header]="'fe.generalComponentContent.username' | translate" sortable="true" [filter]="true" filterMatchMode="contains"
				[style]="{ 'width': '25%' }">
				<template let-report="rowData" pTemplate="body">
					<div class="text-center" [tooltip]="report.userName" placement="top">{{report.userName}}</div>
				</template>
			</p-column>
			<p-column field="firstName" [header]="'fe.generalComponentContent.firstName' | translate" sortable="true" [filter]="true" filterMatchMode="contains"
				[style]="{ 'width': '25%' }">
				<template let-report="rowData" pTemplate="body">
					<div class="text-center" [tooltip]="report.firstName" placement="top">{{report.firstName}}</div>
				</template>
			</p-column>
			<p-column field="lastName" [header]="'fe.generalComponentContent.lastName' | translate" sortable="true" [filter]="true" filterMatchMode="contains"
				[style]="{ 'width': '25%' }">
				<template let-report="rowData" pTemplate="body">
					<div class="text-center" [tooltip]="report.lastName" placement="top">{{report.lastName}}</div>
				</template>
			</p-column>
			<p-column field="companyName" [header]="'fe.generalComponentContent.company' | translate" sortable="true" [filter]="true" filterMatchMode="contains"
				[style]="{ 'width': '25%' }">
				<template let-report="rowData" pTemplate="body">
					<div class="text-center" [tooltip]="report.companyName" placement="top">{{report.companyName}}</div>
				</template>
			</p-column>
			<p-column [header]="'fe.monitoringBookedReports.colStatus' | translate"
				[style]="{ 'width': '12%' }">
				<template let-report="rowData" pTemplate="body">
					<div class="text-center">
						<span placement="top" tooltipClass="statusTooltip" [tooltip]="report.status" [class]="report.status  | lowercase"></span>
					</div>
                </template>
			</p-column>
			<p-column [style]="{ 'width': '25%' }">
				<template let-report="rowData" pTemplate="body">
					<div class="text-center">
						<button type="button" [tooltip]="'fe.generalComponentContent.download' | translate" placement="top" class="btn btn-primary" [disabled]="report.status != 'GENERATED'" (click)="downloadReportFile(report, false)">
							{{ 'fe.generalComponentContent.download' | translate }}
						</button>
						<button type="button" [tooltip]="'fe.generalComponentContent.open' | translate" placement="top" class="btn btn-primary" [disabled]="report.status != 'GENERATED'" (click)="downloadReportFile(report, true)">
							{{ 'fe.generalComponentContent.open' | translate }}
						</button>
					</div>
				</template>
			</p-column>
		</p-dataTable>
	</div>
</div>